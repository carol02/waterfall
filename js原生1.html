<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<style>
			body{
				margin:0;
				padding:0;
			}
			#main{
				position: relative;
			}
			.box{
				padding: 15px 0 0 15px;
				float: left;
			}
			.pic{
				padding: 10px;
				border: 1px solid #CCCCCC;
				border-radius: 5px;
				box-shadow: 0 0 5px #CCCCCC;
			}
			.pic img{
				width: 165px;
				height: auto;
			}
		</style>
	</head>
	<body>
		<div id="main">
			<div class="box">
				<div class="pic">
					<img src="img/0.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/1.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/2.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/3.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/4.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/5.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/7.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/8.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/10.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/11.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/12.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/13.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/14.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/15.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/16.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/17.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/18.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/14.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/15.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/16.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/17.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/18.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/11.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/12.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/13.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/14.jpg"/>
				</div>
			</div>
		</div>
		<script>
			var main=document.getElementById('main');
			var box=document.getElementsByClassName('box');
			var josn={'data':[{'src':'0.jpg'},{'src':'1.jpg'},{'src':'2.jpg'},{'src':'3.jpg'}]}
			var boxW=box[0].offsetWidth;
			//获得列数
			var cols=Math.floor(document.documentElement.clientWidth/boxW); 
			//设置main的宽度和样式
			main.style.cssText='width:'+boxW*cols+'px;margin:0 auto';
			//获取第一行的高度，并去处最小的高度的下标
			window.onload=function(){
				fn();
				function fn(){
				var hArr=[];
				for (var i=0;i<box.length;i++) {
					if(i<cols){
						hArr.push(box[i].offsetHeight)
					}else{
						var minH=Math.min.apply(null,hArr);
						var index=getMinhIndex(hArr,minH);
						box[i].style.position='absolute';
						box[i].style.left=index*boxW+'px';
						box[i].style.top=minH+'px';
						hArr[index]+=box[i].offsetHeight
						//console.log(box[i].offsetHeight)
					}
				}
				
				//获取最小高度box的下标
				function getMinhIndex(arr,val){
					for (var i in arr) {
						if(arr[i]==val){
							return i;
						}
					}
				}
				}
				window.onscroll=function(){
					var lastboxH=box[box.length-1].offsetTop+Math.floor(box[box.length-1].offsetHeight/2);
					var scrolltop=document.body.scrollTop||document.documentElement.scrollTop;
					var height1=document.body.clientHeight||document.documentElement.clientHeight;
					//console.log(lastboxH,scrolltop+height1)
					if(lastboxH<scrolltop+height1){
						for (var i=0;i<josn.data.length;i++) {
							var obox=document.createElement('div');
							obox.className='box';
							main.appendChild(obox);
							var opic=document.createElement('div');
							opic.className='pic';
							obox.appendChild(opic);
							var oimg=document.createElement('img');
							oimg.src='img/'+josn.data[i].src;
							opic.appendChild(oimg)
						}
					}
					fn();
				}
			}
		</script>
	</body>
</html>

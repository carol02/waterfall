<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<style>
			*{
				margin: 0;
				padding: 0;
			}
			#main{
				position: relative;
			}
			.box{
				padding: 15px 0 0 15px;
				float: left;
			}
			.pic{
				padding: 10px;
				border: 1px solid #CCCCCC;
				border-radius: 5px;
				box-shadow: 0 0 5px #CCCCCC;
			}
			.pic img{
				width: 165px;
				height: auto;
			}
		</style>
	</head>
	<body>
		<div id="main">
			<div class="box">
				<div class="pic">
					<img src="img/1.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/2.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/3.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/4.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/5.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/6.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/7.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/8.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/9.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/10.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/11.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/12.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/13.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/14.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/15.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/16.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/17.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/18.jpg"/>
				</div>
			</div>
		</div>
		<script type="text/javascript">
			waterfall('main','box');
			function waterfall(parent,box){
				//将main下的所有class为box的元素取出来
				var oParent=document.getElementById('main');
				var oBoxs=getByClass(oParent,box);
				//console.log(oBoxs.length)
				//计算整个页面显示的列数（页面的宽度/box的宽度）
				var oBoxW=oBoxs[0].offsetWidth;
				var cols=Math.floor(document.documentElement.clientWidth/oBoxW);
				//设置main的宽度
				oParent.style.cssText='width:'+oBoxW*cols+'px;margin:0 auto';
				
				var hArr=[];//存放每一列高度的数组
				for (var i=0;i<oBoxs.length;i++) {
					if(i<cols){
						hArr.push(oBoxs[i].offsetHeight);
					}else{
						var minH=Math.min.apply(null,hArr);
						var index=getMinhIndex(hArr,minH);
						oBoxs[i].style.position='absolute';
						oBoxs[i].style.top=minH+'px';
						oBoxs[i].style.left=oBoxW*index+'px';
						hArr[index]+=oBoxs[i].offsetHeight;
					}
				}
			}
			//获取class元素
			function getByClass(parent,clsName){
				var boxArr=new Array();//用来存贮所有class为box的元素
				 OElements=parent.getElementsByTagName('*')//获取main下所有的class元素
				for (var i=0;i<OElements.length;i++) {//遍历所有的class元素进行判断
					if(OElements[i].className==clsName){
						boxArr.push(OElements[i]);
					}
				}
				return boxArr;
			}
			function getMinhIndex(arr,val){
				for (var i in arr) {
					if(arr[i]==val){
						return i;
					}
				}
			}
		</script>
	</body>
</html>

